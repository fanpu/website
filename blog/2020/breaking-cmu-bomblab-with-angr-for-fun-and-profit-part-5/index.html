<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Breaking CMU's Bomblab with Angr for Fun and Profit - Part 5 | Fan Pu Zeng </title> <meta name="author" content="Fan Pu Zeng"> <meta name="description" content="Part 5 on cracking CMU's Bomblab with Angr, where we solve Phase 5 together!"> <meta name="keywords" content="fanpu, fan pu, fanpu zeng, fan pu zeng, zengfanpu, fanpuzeng, fzeng, CMU, cmu, carnegie mellon, cmu courses, school of computer science, scs, machine learning, computer science, ml, theory, courses, course reviews, CS, Jane Street"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon_new.ico?426605099301e95aedae716cc398b951"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://fanpu.io/blog/2020/breaking-cmu-bomblab-with-angr-for-fun-and-profit-part-5/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Fan Pu</span> Zeng </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/courses/">CMU Course Reviews </a> </li> <li class="nav-item "> <a class="nav-link" href="/cmu-online/">CMU Online </a> </li> <li class="nav-item "> <a class="nav-link" href="/summaries/">ML Paper Summaries </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Breaking CMU's Bomblab with Angr for Fun and Profit - Part 5</h1> <p class="post-meta"> Created in August 02, 2020 by fanpu </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/rev"> <i class="fa-solid fa-hashtag fa-sm"></i> rev</a>   <a href="/blog/tag/ctf"> <i class="fa-solid fa-hashtag fa-sm"></i> ctf</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This is Part 5 on cracking CMU’s Bomblab with Angr. If you just stumbled upon this, I would recommend starting with part 1 <a href="/blog/2020/breaking-cmu-bomblab-with-angr-for-fun-and-profit-part-1/">here</a>.</p> <h3 id="phase-5">Phase 5</h3> <p>Let’s disassemble Phase 5:</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td> <td class="code"><pre><span class="n">gef</span><span class="err">➤</span>  <span class="n">disas</span> <span class="n">phase_5</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">phase_5</span><span class="o">:</span>
   <span class="mh">0x0000000000401062</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="n">push</span>   <span class="n">rbx</span>
   <span class="mh">0x0000000000401063</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span><span class="mh">0x20</span>
   <span class="mh">0x0000000000401067</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">rbx</span><span class="p">,</span><span class="n">rdi</span>
   <span class="mh">0x000000000040106a</span> <span class="o">&lt;+</span><span class="mi">8</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span><span class="n">QWORD</span> <span class="n">PTR</span> <span class="n">fs</span><span class="o">:</span><span class="mh">0x28</span>
   <span class="mh">0x0000000000401073</span> <span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x18</span><span class="p">],</span><span class="n">rax</span>
   <span class="mh">0x0000000000401078</span> <span class="o">&lt;+</span><span class="mi">22</span><span class="o">&gt;:</span>	<span class="n">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x000000000040107a</span> <span class="o">&lt;+</span><span class="mi">24</span><span class="o">&gt;:</span>	<span class="n">call</span>   <span class="mh">0x40131b</span> <span class="o">&lt;</span><span class="n">string_length</span><span class="o">&gt;</span>
   <span class="mh">0x000000000040107f</span> <span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;:</span>	<span class="n">cmp</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x6</span>
   <span class="mh">0x0000000000401082</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">je</span>     <span class="mh">0x4010d2</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">112</span><span class="o">&gt;</span>
   <span class="mh">0x0000000000401084</span> <span class="o">&lt;+</span><span class="mi">34</span><span class="o">&gt;:</span>	<span class="n">call</span>   <span class="mh">0x40143a</span> <span class="o">&lt;</span><span class="n">explode_bomb</span><span class="o">&gt;</span>
   <span class="mh">0x0000000000401089</span> <span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;:</span>	<span class="n">jmp</span>    <span class="mh">0x4010d2</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">112</span><span class="o">&gt;</span>
   <span class="mh">0x000000000040108b</span> <span class="o">&lt;+</span><span class="mi">41</span><span class="o">&gt;:</span>	<span class="n">movzx</span>  <span class="n">ecx</span><span class="p">,</span><span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rbx</span><span class="o">+</span><span class="n">rax</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span>
   <span class="mh">0x000000000040108f</span> <span class="o">&lt;+</span><span class="mi">45</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">],</span><span class="n">cl</span>
   <span class="mh">0x0000000000401092</span> <span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">rdx</span><span class="p">,</span><span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="p">]</span>
   <span class="mh">0x0000000000401096</span> <span class="o">&lt;+</span><span class="mi">52</span><span class="o">&gt;:</span>	<span class="n">and</span>    <span class="n">edx</span><span class="p">,</span><span class="mh">0xf</span>
   <span class="mh">0x0000000000401099</span> <span class="o">&lt;+</span><span class="mi">55</span><span class="o">&gt;:</span>	<span class="n">movzx</span>  <span class="n">edx</span><span class="p">,</span><span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rdx</span><span class="o">+</span><span class="mh">0x4024b0</span><span class="p">]</span>
   <span class="mh">0x00000000004010a0</span> <span class="o">&lt;+</span><span class="mi">62</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="n">rax</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="mh">0x10</span><span class="p">],</span><span class="n">dl</span>
   <span class="mh">0x00000000004010a4</span> <span class="o">&lt;+</span><span class="mi">66</span><span class="o">&gt;:</span>	<span class="n">add</span>    <span class="n">rax</span><span class="p">,</span><span class="mh">0x1</span>
   <span class="mh">0x00000000004010a8</span> <span class="o">&lt;+</span><span class="mi">70</span><span class="o">&gt;:</span>	<span class="n">cmp</span>    <span class="n">rax</span><span class="p">,</span><span class="mh">0x6</span>
   <span class="mh">0x00000000004010ac</span> <span class="o">&lt;+</span><span class="mi">74</span><span class="o">&gt;:</span>	<span class="n">jne</span>    <span class="mh">0x40108b</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">41</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010ae</span> <span class="o">&lt;+</span><span class="mi">76</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x16</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="mh">0x00000000004010b3</span> <span class="o">&lt;+</span><span class="mi">81</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">esi</span><span class="p">,</span><span class="mh">0x40245e</span>
   <span class="mh">0x00000000004010b8</span> <span class="o">&lt;+</span><span class="mi">86</span><span class="o">&gt;:</span>	<span class="n">lea</span>    <span class="n">rdi</span><span class="p">,[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x10</span><span class="p">]</span>
   <span class="mh">0x00000000004010bd</span> <span class="o">&lt;+</span><span class="mi">91</span><span class="o">&gt;:</span>	<span class="n">call</span>   <span class="mh">0x401338</span> <span class="o">&lt;</span><span class="n">strings_not_equal</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010c2</span> <span class="o">&lt;+</span><span class="mi">96</span><span class="o">&gt;:</span>	<span class="n">test</span>   <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x00000000004010c4</span> <span class="o">&lt;+</span><span class="mi">98</span><span class="o">&gt;:</span>	<span class="n">je</span>     <span class="mh">0x4010d9</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">119</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010c6</span> <span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;:</span>	<span class="n">call</span>   <span class="mh">0x40143a</span> <span class="o">&lt;</span><span class="n">explode_bomb</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010cb</span> <span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;:</span>	<span class="n">nop</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rax</span><span class="o">+</span><span class="n">rax</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="mh">0x0</span><span class="p">]</span>
   <span class="mh">0x00000000004010d0</span> <span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;:</span>	<span class="n">jmp</span>    <span class="mh">0x4010d9</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">119</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010d2</span> <span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x0</span>
   <span class="mh">0x00000000004010d7</span> <span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;:</span>	<span class="n">jmp</span>    <span class="mh">0x40108b</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">41</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010d9</span> <span class="o">&lt;+</span><span class="mi">119</span><span class="o">&gt;:</span>	<span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span><span class="n">QWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x18</span><span class="p">]</span>
   <span class="mh">0x00000000004010de</span> <span class="o">&lt;+</span><span class="mi">124</span><span class="o">&gt;:</span>	<span class="n">xor</span>    <span class="n">rax</span><span class="p">,</span><span class="n">QWORD</span> <span class="n">PTR</span> <span class="n">fs</span><span class="o">:</span><span class="mh">0x28</span>
   <span class="mh">0x00000000004010e7</span> <span class="o">&lt;+</span><span class="mi">133</span><span class="o">&gt;:</span>	<span class="n">je</span>     <span class="mh">0x4010ee</span> <span class="o">&lt;</span><span class="n">phase_5</span><span class="o">+</span><span class="mi">140</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010e9</span> <span class="o">&lt;+</span><span class="mi">135</span><span class="o">&gt;:</span>	<span class="n">call</span>   <span class="mh">0x400b30</span> <span class="o">&lt;</span><span class="n">__stack_chk_fail</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x00000000004010ee</span> <span class="o">&lt;+</span><span class="mi">140</span><span class="o">&gt;:</span>	<span class="n">add</span>    <span class="n">rsp</span><span class="p">,</span><span class="mh">0x20</span>
   <span class="mh">0x00000000004010f2</span> <span class="o">&lt;+</span><span class="mi">144</span><span class="o">&gt;:</span>	<span class="n">pop</span>    <span class="n">rbx</span>
   <span class="mh">0x00000000004010f3</span> <span class="o">&lt;+</span><span class="mi">145</span><span class="o">&gt;:</span>	<span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>We see <code class="language-plaintext highlighter-rouge">strings_not_equal</code>, like in Phase 1, and also <code class="language-plaintext highlighter-rouge">string_length</code>. Also, right after the <code class="language-plaintext highlighter-rouge">string_length</code> call there is a comparison with 6, so we can assume that it wants 6 bytes of input. Let’s craft the input again in the same stack frame as the function by setting <code class="language-plaintext highlighter-rouge">rdi</code> to our symbolic bitvector of 6 bytes:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td> <td class="code"><pre><span class="k">def</span> <span class="nf">phase_5</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="c1"># Create an Angr project.
</span>    <span class="n">path_to_binary</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># :string
</span>    <span class="n">project</span> <span class="o">=</span> <span class="n">angr</span><span class="p">.</span><span class="nc">Project</span><span class="p">(</span><span class="n">path_to_binary</span><span class="p">)</span>

    <span class="c1"># Tell Angr where to start executing 
</span>    <span class="n">start_addr</span> <span class="o">=</span> <span class="mh">0x00401062</span>
    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">project</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="nf">blank_state</span><span class="p">(</span><span class="n">addr</span><span class="o">=</span><span class="n">start_addr</span><span class="p">)</span>

    <span class="n">fake_addr</span> <span class="o">=</span> <span class="mh">0x40000000</span>
    <span class="n">input_len</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">phase_5_input</span> <span class="o">=</span> <span class="n">claripy</span><span class="p">.</span><span class="nc">BVS</span><span class="p">(</span><span class="sh">'</span><span class="s">phase_5_input</span><span class="sh">'</span><span class="p">,</span> <span class="n">input_len</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">initial_state</span><span class="p">.</span><span class="n">memory</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">fake_addr</span><span class="p">,</span> <span class="n">phase_5_input</span><span class="p">)</span>
    <span class="n">initial_state</span><span class="p">.</span><span class="n">regs</span><span class="p">.</span><span class="n">rdi</span> <span class="o">=</span> <span class="n">fake_addr</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>Recall how we had to replace <code class="language-plaintext highlighter-rouge">strings_not_equal</code> with our own custom implementation back in Phase 1 to avoid state explosion? I recently found out that there was a really simple way of doing this by using the built-in libc ones that Angr already helpfully provides. For instance, <code class="language-plaintext highlighter-rouge">strings_not_equal</code> can simply be replaced with the libc <code class="language-plaintext highlighter-rouge">strcmp</code>, whose definition can be found <a href="https://github.com/angr/angr/blob/master/angr/procedures/libc/strcmp.py" rel="external nofollow noopener" target="_blank">here</a>. Similarly, <code class="language-plaintext highlighter-rouge">string_length</code> is the same as the libc <code class="language-plaintext highlighter-rouge">strlen</code>, which can be found <a href="https://github.com/angr/angr/blob/master/angr/procedures/libc/strlen.py" rel="external nofollow noopener" target="_blank">here</a>. So let us replace those using this method, to avoid state explosion:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> <td class="code"><pre>    <span class="n">strcmp</span> <span class="o">=</span> <span class="n">angr</span><span class="p">.</span><span class="n">SIM_PROCEDURES</span><span class="p">[</span><span class="sh">'</span><span class="s">libc</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">strcmp</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">strlen</span> <span class="o">=</span> <span class="n">angr</span><span class="p">.</span><span class="n">SIM_PROCEDURES</span><span class="p">[</span><span class="sh">'</span><span class="s">libc</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">strlen</span><span class="sh">'</span><span class="p">]</span>

    <span class="n">strings_not_equal_symbol</span> <span class="o">=</span> <span class="sh">'</span><span class="s">strings_not_equal</span><span class="sh">'</span>
    <span class="n">string_length_symbol</span> <span class="o">=</span> <span class="sh">"</span><span class="s">string_length</span><span class="sh">"</span>

    <span class="n">project</span><span class="p">.</span><span class="nf">hook_symbol</span><span class="p">(</span><span class="n">strings_not_equal_symbol</span><span class="p">,</span> <span class="nf">strcmp</span><span class="p">())</span>
    <span class="n">project</span><span class="p">.</span><span class="nf">hook_symbol</span><span class="p">(</span><span class="n">string_length_symbol</span><span class="p">,</span> <span class="nf">strlen</span><span class="p">())</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>Finally, we set our success address to be at the <code class="language-plaintext highlighter-rouge">ret</code> statement, and the same avoid address as before:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td> <td class="code"><pre>    <span class="c1"># Create a simulation manager initialized with the starting state
</span>    <span class="n">simulation</span> <span class="o">=</span> <span class="n">project</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="nf">simgr</span><span class="p">(</span><span class="n">initial_state</span><span class="p">)</span>

    <span class="n">success_addr</span> <span class="o">=</span> <span class="mh">0x004010f3</span> <span class="c1"># right before ret
</span>    <span class="n">explode_addr</span> <span class="o">=</span> <span class="mh">0x0040143a</span> <span class="c1"># explode_bomb
</span>
    <span class="n">simulation</span><span class="p">.</span><span class="nf">explore</span><span class="p">(</span><span class="n">find</span><span class="o">=</span><span class="n">success_addr</span><span class="p">,</span> <span class="n">avoid</span><span class="o">=</span><span class="n">explode_addr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">simulation</span><span class="p">.</span><span class="n">found</span><span class="p">:</span>
        <span class="n">solution_state</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">.</span><span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Case symbolic value to bytes
</span>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution_state</span><span class="p">.</span><span class="n">se</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">phase_5_input</span><span class="p">,</span> <span class="n">cast_to</span><span class="o">=</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">'</span><span class="s">Could not find the solution</span><span class="sh">'</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></figure> <h3 id="almost-there">Almost There?</h3> <p>Let’s try running it!</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> <td class="code"><pre><span class="err">$</span> <span class="n">python</span> <span class="n">solve</span><span class="p">.</span><span class="n">py</span> <span class="n">bomb</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">The</span> <span class="n">program</span> <span class="n">is</span> <span class="n">accessing</span> <span class="n">memory</span> <span class="n">or</span> <span class="n">registers</span> <span class="n">with</span> <span class="n">an</span> <span class="n">unspecified</span> <span class="n">value</span><span class="p">.</span> <span class="n">This</span> <span class="n">could</span> <span class="n">indicate</span> <span class="n">unwanted</span> <span class="n">behavior</span><span class="p">.</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">angr</span> <span class="n">will</span> <span class="n">cope</span> <span class="n">with</span> <span class="n">this</span> <span class="n">by</span> <span class="n">generating</span> <span class="n">an</span> <span class="n">unconstrained</span> <span class="n">symbolic</span> <span class="n">variable</span> <span class="n">and</span> <span class="n">continuing</span><span class="p">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">resolve</span> <span class="n">this</span> <span class="n">by</span><span class="o">:</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="n">setting</span> <span class="n">a</span> <span class="n">value</span> <span class="n">to</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">state</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">2</span><span class="p">)</span> <span class="n">adding</span> <span class="n">the</span> <span class="n">state</span> <span class="n">option</span> <span class="n">ZERO_FILL_UNCONSTRAINED_</span><span class="p">{</span><span class="n">MEMORY</span><span class="p">,</span><span class="n">REGISTERS</span><span class="p">},</span> <span class="n">to</span> <span class="n">make</span> <span class="n">unknown</span> <span class="n">regions</span> <span class="n">hold</span> <span class="n">null</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">3</span><span class="p">)</span> <span class="n">adding</span> <span class="n">the</span> <span class="n">state</span> <span class="n">option</span> <span class="n">SYMBOL_FILL_UNCONSTRAINED_</span><span class="p">{</span><span class="n">MEMORY_REGISTERS</span><span class="p">},</span> <span class="n">to</span> <span class="n">suppress</span> <span class="n">these</span> <span class="n">messages</span><span class="p">.</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">569</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="k">register</span> <span class="n">rbx</span> <span class="n">with</span> <span class="mi">8</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401062</span> <span class="p">(</span><span class="n">phase_5</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401062</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">579</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x40000006</span> <span class="n">with</span> <span class="mi">250</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x40131b</span> <span class="p">(</span><span class="n">string_length</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x40131b</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">694</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffeffd1</span> <span class="n">with</span> <span class="mi">7</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401092</span> <span class="p">(</span><span class="n">phase_5</span><span class="o">+</span><span class="mh">0x30</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401092</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">23</span><span class="p">,</span><span class="mi">609</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffefff8</span> <span class="n">with</span> <span class="mi">232</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401338</span> <span class="p">(</span><span class="n">strings_not_equal</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401338</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">23</span><span class="p">,</span><span class="mi">610</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffeffe7</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401338</span> <span class="p">(</span><span class="n">strings_not_equal</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401338</span><span class="p">))</span>
<span class="n">CRITICAL</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">24</span><span class="p">,</span><span class="mi">220</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">sim_state</span> <span class="o">|</span> <span class="n">The</span> <span class="n">name</span> <span class="n">state</span><span class="p">.</span><span class="n">se</span> <span class="n">is</span> <span class="n">deprecated</span><span class="p">;</span> <span class="n">please</span> <span class="n">use</span> <span class="n">state</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span>
<span class="n">b</span><span class="err">'\</span><span class="n">t</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x0e</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x06</span><span class="err">\</span><span class="n">x07</span><span class="err">'</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>We indeed got a solution, but those are not ASCII printable characters! Of course, we can pipe the input to the binary with something like pwntools, but this seems to not be the point of the assignment. This is where we introduce the new concept of adding constraints to our input.</p> <h3 id="adding-constraints">Adding Constraints</h3> <p>We want to constrain our input bytes such that they are in the printable range. For simplicity, I will restrict it further to be smallest range that include the alphanumeric range, which includes a few non-alphanumeric characters as well. This will range from ‘0’ (0x30) to ‘z’ (0x7A), which you can quickly verify by pulling up an ASCII table with <code class="language-plaintext highlighter-rouge">man ascii</code>.</p> <p>We’ll add these constraints right before we build the simulation:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="code"><pre>    <span class="k">def</span> <span class="nf">constrain_printable</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">claripy</span><span class="p">.</span><span class="nc">And</span><span class="p">(</span><span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="p">,</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">input_len</span><span class="p">):</span>
        <span class="n">initial_state</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">constrain_printable</span><span class="p">(</span><span class="n">phase_5_input</span><span class="p">.</span><span class="nf">get_byte</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>Now, we will either get a solution that is printable, or perhaps no solution at all. Let’s try:</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> <td class="code"><pre><span class="err">$</span> <span class="n">python</span> <span class="n">solve</span><span class="p">.</span><span class="n">py</span> <span class="n">bomb</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">The</span> <span class="n">program</span> <span class="n">is</span> <span class="n">accessing</span> <span class="n">memory</span> <span class="n">or</span> <span class="n">registers</span> <span class="n">with</span> <span class="n">an</span> <span class="n">unspecified</span> <span class="n">value</span><span class="p">.</span> <span class="n">This</span> <span class="n">could</span> <span class="n">indicate</span> <span class="n">unwanted</span> <span class="n">behavior</span><span class="p">.</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">angr</span> <span class="n">will</span> <span class="n">cope</span> <span class="n">with</span> <span class="n">this</span> <span class="n">by</span> <span class="n">generating</span> <span class="n">an</span> <span class="n">unconstrained</span> <span class="n">symbolic</span> <span class="n">variable</span> <span class="n">and</span> <span class="n">continuing</span><span class="p">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">resolve</span> <span class="n">this</span> <span class="n">by</span><span class="o">:</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">1</span><span class="p">)</span> <span class="n">setting</span> <span class="n">a</span> <span class="n">value</span> <span class="n">to</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">state</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">2</span><span class="p">)</span> <span class="n">adding</span> <span class="n">the</span> <span class="n">state</span> <span class="n">option</span> <span class="n">ZERO_FILL_UNCONSTRAINED_</span><span class="p">{</span><span class="n">MEMORY</span><span class="p">,</span><span class="n">REGISTERS</span><span class="p">},</span> <span class="n">to</span> <span class="n">make</span> <span class="n">unknown</span> <span class="n">regions</span> <span class="n">hold</span> <span class="n">null</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="mi">3</span><span class="p">)</span> <span class="n">adding</span> <span class="n">the</span> <span class="n">state</span> <span class="n">option</span> <span class="n">SYMBOL_FILL_UNCONSTRAINED_</span><span class="p">{</span><span class="n">MEMORY_REGISTERS</span><span class="p">},</span> <span class="n">to</span> <span class="n">suppress</span> <span class="n">these</span> <span class="n">messages</span><span class="p">.</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">766</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="k">register</span> <span class="n">rbx</span> <span class="n">with</span> <span class="mi">8</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401062</span> <span class="p">(</span><span class="n">phase_5</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401062</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">796</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x40000006</span> <span class="n">with</span> <span class="mi">250</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x40131b</span> <span class="p">(</span><span class="n">string_length</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x40131b</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">906</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffeffd1</span> <span class="n">with</span> <span class="mi">7</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401092</span> <span class="p">(</span><span class="n">phase_5</span><span class="o">+</span><span class="mh">0x30</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401092</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">45</span><span class="p">,</span><span class="mi">753</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffefff8</span> <span class="n">with</span> <span class="mi">232</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401338</span> <span class="p">(</span><span class="n">strings_not_equal</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401338</span><span class="p">))</span>
<span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">45</span><span class="p">,</span><span class="mi">753</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">state_plugins</span><span class="p">.</span><span class="n">symbolic_memory</span> <span class="o">|</span> <span class="n">Filling</span> <span class="n">memory</span> <span class="n">at</span> <span class="mh">0x7fffffffffeffe7</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">unconstrained</span> <span class="n">bytes</span> <span class="n">referenced</span> <span class="n">from</span> <span class="mh">0x401338</span> <span class="p">(</span><span class="n">strings_not_equal</span><span class="o">+</span><span class="mh">0x0</span> <span class="n">in</span> <span class="n">bomb</span> <span class="p">(</span><span class="mh">0x401338</span><span class="p">))</span>
<span class="n">CRITICAL</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="mi">356</span> <span class="o">|</span> <span class="n">angr</span><span class="p">.</span><span class="n">sim_state</span> <span class="o">|</span> <span class="n">The</span> <span class="n">name</span> <span class="n">state</span><span class="p">.</span><span class="n">se</span> <span class="n">is</span> <span class="n">deprecated</span><span class="p">;</span> <span class="n">please</span> <span class="n">use</span> <span class="n">state</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span>
<span class="n">b</span><span class="err">'</span><span class="mi">9</span><span class="o">?&gt;</span><span class="mi">567</span><span class="err">'</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>Fantastic! Let’s try this input on the bomb:</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> <td class="code"><pre><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">bomb</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">my</span> <span class="n">fiendish</span> <span class="n">little</span> <span class="n">bomb</span><span class="p">.</span> <span class="n">You</span> <span class="n">have</span> <span class="mi">6</span> <span class="n">phases</span> <span class="n">with</span>
<span class="n">which</span> <span class="n">to</span> <span class="n">blow</span> <span class="n">yourself</span> <span class="n">up</span><span class="p">.</span> <span class="n">Have</span> <span class="n">a</span> <span class="n">nice</span> <span class="n">day</span><span class="o">!</span>
<span class="n">Border</span> <span class="n">relations</span> <span class="n">with</span> <span class="n">Canada</span> <span class="n">have</span> <span class="n">never</span> <span class="n">been</span> <span class="n">better</span><span class="p">.</span>
<span class="n">Phase</span> <span class="mi">1</span> <span class="n">defused</span><span class="p">.</span> <span class="n">How</span> <span class="n">about</span> <span class="n">the</span> <span class="n">next</span> <span class="n">one</span><span class="o">?</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">16</span> <span class="mi">32</span>
<span class="n">That</span><span class="err">'</span><span class="n">s</span> <span class="n">number</span> <span class="mi">2</span><span class="p">.</span>  <span class="n">Keep</span> <span class="n">going</span><span class="o">!</span>
<span class="mi">1</span> <span class="mi">311</span>
<span class="n">Halfway</span> <span class="n">there</span><span class="o">!</span>
<span class="mi">7</span> <span class="mi">0</span>
<span class="n">So</span> <span class="n">you</span> <span class="n">got</span> <span class="n">that</span> <span class="n">one</span><span class="p">.</span>  <span class="n">Try</span> <span class="n">this</span> <span class="n">one</span><span class="p">.</span>
<span class="mi">9</span><span class="o">?&gt;</span><span class="mi">567</span>
<span class="n">Good</span> <span class="n">work</span><span class="o">!</span>  <span class="n">On</span> <span class="n">to</span> <span class="n">the</span> <span class="n">next</span><span class="p">...</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>Looks like it worked! Thanks for reading so far, and I hope you enjoyed it! You can continue on to Part 6 <a href="/blog/2020/breaking-cmu-bomblab-with-angr-for-fun-and-profit-part-6/">here</a>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <p class="mb-2">Related Posts:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/llama-3.1-technical-report-notes/">Notes on 'The Llama 3 Herd of Models'</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/setting-up-yuancon-controller-sound-voltex/">Playing Sound Voltex at Home: Setting Up Unnamed SDVX Clone with the Yuancon SDVX Controller</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/creating-trackback-requests/">Creating Trackback Requests for Static Sites</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/high-dimensional-analysis-of-m-estimators/">A Unified Framework for High-Dimensional Analysis of M-Estimators with Decomposable Regularizers: A Guided Walkthrough</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/cmu-steam-tunnels/">The CMU Steam Tunnels and Wean 9</a> </li> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'fanpu/fanpu.github.io',
        'data-repo-id': '',
        'data-category': 'Comments',
        'data-category-id': '',
        'data-mapping': 'title',
        'data-strict': '1',
        'data-reactions-enabled': '1',
        'data-emit-metadata': '0',
        'data-input-position': 'bottom',
        'data-theme': giscusTheme,
        'data-lang': 'en',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Fan Pu Zeng. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: January 01, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script src="/assets/js/tooltips-setup.js?53023e960fbc64cccb90d32e9363de2b"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-S3VHEYH05S"></script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>